<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
   
   
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
      
      
      
      <style>
        #testResults{
          margin: 2em;
          border-top: solid 1pt black;
          }
        .success{
          background-color: #ccffcc;
          }
        .failure{
          background-color: #ffcccc;
          }
      </style>
      
      <!-- 
             This is the style element that is inserted by the static search 
             build process. It will be replaced every time you build the search. 
             To override it, you can add your own style element AFTER this
             one.
      -->
      
      
      <style id="ssCss"><!--
        form#ssForm{
            display: flex;
            flex-direction: column;
        }
        span.ssQueryAndButton{
            display: flex;
            flex-direction: row;
            margin: 0.25em auto;
            width: 100%;
        }
        input#ssQuery{
            flex: 1;
        }
        div.ssDescFilters, div.ssDateFilters, div.ssNumFilters, div.ssBoolFilters{
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
        }
        div.ssDescFilters fieldset, div.ssDateFilters fieldset, div.ssNumFilters fieldset, div.ssBoolFilters fieldset{
            margin: 0.25em auto;
            padding: 0.25em;
            /* Chromium bug means flex doesn't work in fieldsets. Curses. :-( */
            flex-grow: 1;
            display: flex;
            flex-wrap: wrap;
        }
        ul.ssDescCheckboxList{
            list-style-type: none;
            max-height: 8em;
            overflow-y: auto;
            min-width: 90%;
        }
        ul.ssDescCheckboxList li{
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            align-items: flex-start;
        }
        div.ssDateFilters fieldset.ssFieldset span, div.ssNumFilters fieldset.ssFieldset span, div.ssBoolFilters fieldset.ssFieldset span{
            padding: 0.5em 1em;
        }
        fieldset.ssFieldset > span {
            background-color: #ddd;
            border: solid 1px #aaa;
            margin: 0.2em;
        }
        div.ssNumFilters input[type="number"], div.ssDateFilters input[type="text"]{
            padding: 0.5em;
        }
        div#ssSearching{
            background-color: #000000;
            color: #ffffff;
            font-size: 1.5rem;
            padding: 1rem;
            border-radius: 0.25rem 0.25rem;
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }
        div#ssResults>ul>li{
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            margin-top: 0.75em;
        }
        div#ssResults>ul>li>a{
            flex-grow: 0;
        }
        div#ssResults>ul>li>div{
          flex-grow: 1;
        }
        div#ssResults>ul>li>a>img{
            max-width: 10em;
            margin-right: 1em;
            min-width: 3em;
            min-height: 3em;
        }
    --></style>
      
      
      <title>Test search page</title>
      </head>
   
   
   <body>
      
      
      <h1>Test search page</h1>
      
      
      <p>This is a simple search page for the test collection. It runs a number of automated
         tests on load.
         Note that the <q>Document type</q> options should appear sorted in reverse alphabetical order, 
         as a test of the functionality of the <code>@data-ssFilterSortKey</code> setting; the <q>Random 
            numeric value</q> options should appear in ascending numeric order although they do not have a
         configured <code>@data-ssFilterSortKey</code> setting.</p>
      
      <!-- 
             This is the div into which the JavaScript and page components required for the
             search are inserted during the build process. The contents of this div are replaced
            every time you run a search build.
      -->
      
      
      <div id="staticSearch"><script src="ssTest/ssStemmer.js"></script><script src="ssTest/ssSearch.js"></script><script>
                var Sch;
                window.addEventListener('load', function(){Sch = new StaticSearch();});
            </script><form accept-charset="UTF-8" id="ssForm" data-allowphrasal="yes" data-allowwildcards="yes" data-maxkwicstoshow="3" onsubmit="return false;" data-versionstring="_fatal:_not_a_git_repository_(or_any_parent_up_to_mount_point_/)_Stopping_at_filesystem_boundary_(GIT_DISCOVERY_ACROSS_FILESYSTEM_not_set)." data-ssfolder="ssTest"><span class="ssQueryAndButton"><input type="text" id="ssQuery"/><button id="ssDoSearch">Search</button></span></form>
         <div id="ssSearching">Searching...</div>
         <div id="ssResults"></div>
      </div>
      
      <!-- 
             This is a special search page component which is used only for testing 
             the static search. You do not need or want any of the following stuff in
             your own site's search page.
      -->
      <script>
          <!--
           //This is a set of automated tests which are intended to check whether
           //we're getting the results we expect back from the search object.
           var reportDiv = null;


           var currTestNum = -1;
           var tests = [];

           //Simple one-word search.
           tests.push({setup: function(){Sch.queryBox.value = 'elephant';},
                       check: function(num){console.log('Search hook ' + num);
                                            console.log('Testing results for the word "elephant".');
                                            checkResults({docsFound: 2, contextsFound: 4, scoreTotal: 4});}});

           //Another simple one-word search.
           tests.push({setup: function(){Sch.queryBox.value = 'twilight';},
                       check: function(num){console.log('Search hook ' + num);
                                            console.log('Testing results for the word "twilight".');
                                            checkResults({docsFound: 2, contextsFound: 3, scoreTotal: 3});}});

           //Another simple one-word search but using a desc filter.
           tests.push({setup: function(){Sch.queryBox.value = 'twilight'; document.querySelector('input[value="Site info files"]').checked = 'checked';},
                       check: function(num){console.log('Search hook ' + num);
                                            console.log('Testing results for the word "twilight with Site info files desc filter".');
                                            checkResults({docsFound: 1, contextsFound: 1, scoreTotal: 1});}});

           //Third simple one-word search.
           tests.push({setup: function(){Sch.queryBox.value = 'across';},
                       check: function(num){console.log('Search hook ' + num);
                                            console.log('Testing results for the word "across".', true);
                                            checkResults({docsFound: 2, contextsFound: 2, scoreTotal: 2});}});

           //Same word with date.
           tests.push({setup: function(){Sch.queryBox.value = 'across'; document.querySelector('input[title="Date range"][id$="_from"]').value = '2000';},
                       check: function(num){console.log('Search hook ' + num);
                                            console.log('Testing results for the word "across" in documents since 2000.');
                                            checkResults({docsFound: 1, contextsFound: 1, scoreTotal: 1});}});
                                            
           // Simple one word phrase that should only exist in badthings.html
           tests.push({setup: function(){Sch.queryBox.value = 'ignominious';},
                      check: function(num){console.log('Search hook ' + num);
                      console.log('Testing results for the phrase "ignominious"');
                      checkResults({docsFound: 1, contextsFound: 1, scoreTotal: 1});}});
                      

           //Phrasal search. This one tests ignored inlines.
           tests.push({setup: function(){Sch.queryBox.value = '"summer day—our day"';},
                                         check: function(num){console.log('Search hook ' + num);
                                         console.log('Testing results for the phrase "summer day—our day".');
                                         checkResults({docsFound: 2, contextsFound: 2, scoreTotal: 2});}});

           //Phrasal search with boundary contexts.
           tests.push({setup: function(){Sch.queryBox.value = '"our day Was clouded"';},
                                         check: function(num){console.log('Search hook ' + num);
                                         console.log('Testing results for the phrase "our day Was clouded".');
                                         checkResults({docsFound: 1, contextsFound: 1, scoreTotal: 1});}});

           //Phrasal search with boundary contexts.
           tests.push({setup: function(){Sch.queryBox.value = '"our day Was clouded"'; document.querySelector('input[title="Date range"][id$="_to"]').value = '2000';},
                                         check: function(num){console.log('Search hook ' + num);
                                         console.log('Testing results for the phrase "our day Was clouded" with max date 2000.');
                                         checkResults({docsFound: 0, contextsFound: 0, scoreTotal: 0});}});

           //Two MUST_CONTAINs with boolean flag.
           tests.push({setup: function(){Sch.queryBox.value = '+green +golden'; document.querySelector('select[title="Worth reading"]').selectedIndex = 2;},
                                         check: function(num){console.log('Search hook ' + num);
                                         console.log('Testing results for the phrase "+green +golden" with boolean flag "Worth reading" false.');
                                         checkResults({docsFound: 1, contextsFound: 2, scoreTotal: 2});}});
                                                                                  
            //Search based only on filters, no terms.
             tests.push({setup: function(){Sch.queryBox.value = ''; document.querySelector('input[value="Poems"]').checked = 'checked'; document.querySelector('select[title="Worth reading"]').selectedIndex = 1;},
                                         check: function(num){console.log('Search hook ' + num);
                                         console.log('Testing results for pure filter search: poems worth reading.');
                                         checkResults({docsFound: 2, contextsFound: 0, scoreTotal: 0});}});
                                         
           //Search for a word that's in the stopword list
           tests.push({setup: function(){Sch.queryBox.value = 'artichoke';},
                                         check: function(num){console.log('Search hook ' + num);
                                         console.log('Testing results for the word "artichoke", which is in the stopwords list.');
                                         checkResults({docsFound: 0, contextsFound: 0, scoreTotal: 0});}});
                                         
           //Search for a word that has no whitespace around it, just linebreaks.
           tests.push({setup: function(){Sch.queryBox.value = 'dog';},
                                         check: function(num){console.log('Search hook ' + num);
                                         console.log('Testing results for the word "dog", which in one document has no spaces around it, just linebreaks.');
                                         
                                         checkResults({docsFound: 2, contextsFound: 4, scoreTotal: 4});}});
           //Search using the number filter.
           tests.push({setup: function(){Sch.queryBox.value = 'dog'; document.querySelector('input[title="Number of animal names"][id$="_from"]').value = '3';},
                                         check: function(num){console.log('Search hook ' + num);
                                         console.log('Testing results for the word "dog", in a document mentioning at least three animals.');
                                         checkResults({docsFound: 2, contextsFound: 4, scoreTotal: 4});}});

           //Search using the a wildcard.
           tests.push({setup: function(){Sch.queryBox.value = 'att*'},
                                         check: function(num){console.log('Search hook ' + num);
                                         console.log('Testing results for the wildcard "att*", which should find "attempt" and "attached".');
                                         checkResults({docsFound: 2, contextsFound: 2, scoreTotal: 2});}});

            //Search for a single word as a phrase, to test word-boundaries etc.
            tests.push({setup: function(){Sch.queryBox.value = '"dog"'},
                                         check: function(num){console.log('Search hook ' + num);
                                         console.log('Testing results for the one-word phrase "dog", which should find 3 instances in one file.');
                                         checkResults({docsFound: 1, contextsFound: 3, scoreTotal: 3});}});                             
           


           function runTests(){
             reportDiv = document.querySelector('div#testResults');

            //Turn off browser history tracking otherwise life gets complicated
            //when running a sequence of automated tests.
             Sch.storeSearchesInBrowserHistory = false;
             //Turning on the report functionality so we have better clues
             //when things go wrong.
             Sch.showSearchReport = true;
             
             reportResults('Running automated tests.', true);

           }

           function reportResults(msg, succeed){
             reportDiv.innerHTML += '<p class="' + (succeed ? 'success':'failure') + '">' + msg + '</p>';
             if (succeed){
               Sch.clearSearchForm();
               currTestNum++;
               if (currTestNum >= tests.length){
                  reportDiv.innerHTML += '<p class="success">Done!</p>';
                  Sch.searchFinishedHook = function(){};
                  return;
               }
               tests[currTestNum].setup.call();
               Sch.searchFinishedHook = tests[currTestNum].check;
               Sch.doSearch();
             }
           }

           //This calls the search object's resultSet instance to get a
           //set of totals to compare with what we expect.
           function checkResults(obj){
             let results = Sch.resultSet.resultsAsObject();
             let msg = 'Hit documents: expected ' + obj.docsFound;
             msg += '; found ' + results.docsFound + '. ';
             msg += 'Hit contexts: expected ' + obj.contextsFound;
             msg += '; found ' + results.contextsFound + '. ';
             msg += 'Total of all scores: expected ' + obj.scoreTotal;
             msg += '; found ' + results.scoreTotal + '. ';
             let succeed = ((obj.docsFound === results.docsFound)
                          &&(obj.contextsFound === results.contextsFound)
                          &&(obj.scoreTotal === results.scoreTotal));
             reportResults(msg, succeed);
           }

           window.addEventListener('load', runTests);

           -->
       </script>
      
      
      <div id="testResults">
         
         </div>
      
      </body>
   </html>